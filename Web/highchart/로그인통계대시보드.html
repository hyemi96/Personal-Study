<%@ page contentType="text/html;charset=UTF-8"%>
<!-- <script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>  헤더에 따로 작성-->
<style>

.highcharts-figure,
.highcharts-data-table table {
  min-width: 400px;
  max-width: 800px;
  margin: 1em auto;
}

.highcharts-data-table table {
  font-family: Verdana, sans-serif;
  border-collapse: collapse;
  border: 1px solid #ebebeb;
  margin: 10px auto;
  text-align: center;
  width: 100%;
  max-width: 500px;
}

.highcharts-data-table caption {
  padding: 1em 0;
  font-size: 1.2em;
  color: #555;
}

.highcharts-data-table th {
  font-weight: 600;
  padding: 0.5em;
}

.highcharts-data-table td,
.highcharts-data-table th,
.highcharts-data-table caption {
  padding: 0.5em;
}

.highcharts-data-table thead tr,
.highcharts-data-table tr:nth-child(even) {
  background: #f8f8f8;
}

.highcharts-data-table tr:hover {
  background: #f1f7ff;
}


#container {
	height: 300px;
}

.highcharts-figure, .highcharts-data-table table {
	min-width: 600px;
	max-width: 1000px;
	margin: 1em auto;
}

.highcharts-data-table table {
	font-family: Verdana, sans-serif;
	border-collapse: collapse;
	border: 1px solid #ebebeb;
	margin: 10px auto;
	text-align: center;
	width: 100%;
	max-width: 500px;
}

.highcharts-data-table caption {
	padding: 1em 0;
	font-size: 1.2em;
	color: #555;
}

.highcharts-data-table th {
	font-weight: 600;
	padding: 0.5em;
}

.highcharts-data-table td, .highcharts-data-table th,
	.highcharts-data-table caption {
	padding: 0.5em;
}

.highcharts-data-table thead tr, .highcharts-data-table tr:nth-child(even)
	{
	background: #f8f8f8;
}

.highcharts-data-table tr:hover {
	background: #f1f7ff;
}


</style>
<script type="text/javascript">
	$(document).ready(function() {
		
		//현재 날짜 표기
		getToday();
		
		containerHighcharts();
		
		siteChange(); //웹선택
		
		webPieHighcharts();
		
		mobilePieHighcharts();
		
		weekStatisticHighcharts();
		

	});

	function getToday() {
		let today = new Date();
		let year = today.getFullYear(); // 2022
		let month = today.getMonth()+ 1; // month에 1을 더하는 이유는 0부터 시작하기때문 
		let date = today.getDate(); //  (일)
		let day = today.getDay(); // 3 (수요일)
		let hours = today.getHours(); 
		let minutes = today.getMinutes();

		let week = [ '일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일' ];

		let dayOfWeek = week[new Date(today).getDay()];

		document.getElementById('todayData').innerHTML = year + '년 ' + month + '월 ' + date + '일 '+ dayOfWeek;
	
		$('#weekTodayDate').html(month + '/' + date + ' ' + hours + ":" + minutes);
	}
	
	function siteChange(){
		let siteSelectedText = $('#selectSite option:checked').text();
		$('#countTitle').html(siteSelectedText);
		
		let optVal = $('#selectSite').val();
		console.log(optVal);
		
		var sysCd = "";
		var sysCdExt = "";
		var osDiv = "";
		
		var tempArray = optVal.split(":");
		
		sysCd = tempArray[0];
		sysCdExt = tempArray[1];
		osDiv = tempArray[2];

		if(optVal ==""){
			return;
		}else {
			
			console.log(sysCd);
			console.log(sysCdExt);
			console.log(osDiv);
			
			var data = {"sysCd" : sysCd, "sysCdExt" : sysCdExt, "osDiv" : osDiv}
			
			$.ajax({
				url : "/control/ajaxSelectLogCnt.do",
				data : data,
				type : 'POST',
				dataType : 'json',
				contentType : "application/x-www-form-urlencoded;charset=UTF-8",
				success : function(arg) {
					
					//나온 결과로 오늘 방문수, 어제방문수, 누적 방문수로 나눠 결과를 html에 넣어준다.
					$('#todayCnt').html(arg.TodayCnt);
					$('#yesterdayCnt').html(arg.YesterdayCnt);
					$('#accumulateCnt').html(arg.AccumulateCnt);
			
				},
				error : function() {

				}
			});
			
		}
		
	}
	
	function containerHighcharts(){
		
		var b2cOption = [];
		
		var option = $("#selectLoginStatisticOption").val();
		
		console.log(option);
		
		if(option=="day"){
			b2cOption = ["1","2", "3", "4", "5","6","7"]; //월조회 
		}else if(option == "month"){
			b2cOption = [ '1월','2월', '3월','4월', '5월' , '6월' , '7월', '8월', '9월' ,'10월', '11월', '12월'];
		}else if(option == "year"){
			b2cOption = [ "2021", "2022"];
		}
		//ajax를 통해 데이터를 가져온 후 data를 그래프에 넣어준다.
		
		
		//B2C 소셜 로그인 통계
		Highcharts.chart('container',{
			chart : {
				type : 'column'
			},
			title : {
				text : 'B2C 소셜 로그인 비율'
			},
			xAxis : {
				categories : b2cOption //일간/주간/월간
			},
			yAxis : {
				min : 0,
				title : {
					text : 'Total'
				},
				stackLabels : {
					enabled : true,
					style : {
						fontWeight : 'bold',
						color : ( // theme
						Highcharts.defaultOptions.title.style && Highcharts.defaultOptions.title.style.color)
								|| '#ffff00'
					}
	
				}
			},
			legend : {
				align : 'right',
				x : -30,
				verticalAlign : 'top',
				y : 25,
				floating : true,
				backgroundColor : Highcharts.defaultOptions.legend.backgroundColor
						|| 'white',
				borderColor : '#CCC',
				borderWidth : 1,
				shadow : false
			},
			tooltip : {
				headerFormat : '<b>{point.x}</b><br/>',
				pointFormat : '{series.name}: {point.y}<br/>Total: {point.stackTotal}'
			},
			plotOptions : {
				column : {
					stacking : 'normal',
					dataLabels : {
						enabled : true
					}
				}
			},
			series : [ {
				name : '하이제라',
				data : [ 5, 3, 4, 7, 2, 4, 5, 6, 8, 10, 9, 8, ],
				color: '#1E3269'
			}, {
				name : '카카오',
				data : [ 2, 2, 3, 2, 1, 8, 4, 8, 7, 7, 5, 9, ],
				color: '#FFC31E'
			}, {
				name : '네이버',
				data : [ 3, 4, 4, 0, 5, 5, 8, 8, 9, 4, 8, 10, ], //데이터 값
				color: '#0A6E0A'
			} ]
		});

	
	}
	
	// 브라우저 통계 그래프
	function webPieHighcharts(){
		Highcharts.chart('webPie', {
		  chart: {
		    type: 'pie'
		  },
		  title: {
		    text: 'Browser market shares. January, 2022'
		  },
	
		  accessibility: {
		    announceNewData: {
		      enabled: true
		    },
		    point: {
		      valueSuffix: '%'
		    }
		  },
	
		  plotOptions: {
		    series: {
		      dataLabels: {
		        enabled: true,
		        format: '{point.name}: {point.y:.1f}%'
		      }
		    }
		  },
	
		  tooltip: {
		    headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
		    pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'
		  },
	
		  series: [
		    {
		      name: "Browsers",
		      colorByPoint: true,
		      data: [
		        {
		          name: "Chrome",
		          y: 62.74,
		          drilldown: "Chrome"
		        },
		        {
		          name: "Firefox",
		          y: 10.57,
		          drilldown: "Firefox"
		        },
		        {
		          name: "Internet Explorer",
		          y: 7.23,
		          drilldown: "Internet Explorer"
		        },
		        {
		          name: "Safari",
		          y: 5.58,
		          drilldown: "Safari"
		        },
		        {
		          name: "Edge",
		          y: 4.02,
		          drilldown: "Edge"
		        },
		        {
		          name: "Opera",
		          y: 1.92,
		          drilldown: "Opera"
		        },
		        {
		          name: "Other",
		          y: 7.62,
		          drilldown: null
		        }
		      ]
		    }
		  ],
		  drilldown: {
		    series: [
		      {
		        name: "Chrome",
		        id: "Chrome",
		        data: [
		          [
		            "v65.0",
		            0.1
		          ],
		          [
		            "v64.0",
		            1.3
		          ],
		          [
		            "v63.0",
		            53.02
		          ],
		          [
		            "v62.0",
		            1.4
		          ],
		          [
		            "v61.0",
		            0.88
		          ],
		          [
		            "v60.0",
		            0.56
		          ],
		          [
		            "v59.0",
		            0.45
		          ],
		          [
		            "v58.0",
		            0.49
		          ],
		          [
		            "v57.0",
		            0.32
		          ],
		          [
		            "v56.0",
		            0.29
		          ],
		          [
		            "v55.0",
		            0.79
		          ],
		          [
		            "v54.0",
		            0.18
		          ],
		          [
		            "v51.0",
		            0.13
		          ],
		          [
		            "v49.0",
		            2.16
		          ],
		          [
		            "v48.0",
		            0.13
		          ],
		          [
		            "v47.0",
		            0.11
		          ],
		          [
		            "v43.0",
		            0.17
		          ],
		          [
		            "v29.0",
		            0.26
		          ]
		        ]
		      },
		      {
		        name: "Firefox",
		        id: "Firefox",
		        data: [
		          [
		            "v58.0",
		            1.02
		          ],
		          [
		            "v57.0",
		            7.36
		          ],
		          [
		            "v56.0",
		            0.35
		          ],
		          [
		            "v55.0",
		            0.11
		          ],
		          [
		            "v54.0",
		            0.1
		          ],
		          [
		            "v52.0",
		            0.95
		          ],
		          [
		            "v51.0",
		            0.15
		          ],
		          [
		            "v50.0",
		            0.1
		          ],
		          [
		            "v48.0",
		            0.31
		          ],
		          [
		            "v47.0",
		            0.12
		          ]
		        ]
		      },
		      {
		        name: "Internet Explorer",
		        id: "Internet Explorer",
		        data: [
		          [
		            "v11.0",
		            6.2
		          ],
		          [
		            "v10.0",
		            0.29
		          ],
		          [
		            "v9.0",
		            0.27
		          ],
		          [
		            "v8.0",
		            0.47
		          ]
		        ]
		      },
		      {
		        name: "Safari",
		        id: "Safari",
		        data: [
		          [
		            "v11.0",
		            3.39
		          ],
		          [
		            "v10.1",
		            0.96
		          ],
		          [
		            "v10.0",
		            0.36
		          ],
		          [
		            "v9.1",
		            0.54
		          ],
		          [
		            "v9.0",
		            0.13
		          ],
		          [
		            "v5.1",
		            0.2
		          ]
		        ]
		      },
		      {
		        name: "Edge",
		        id: "Edge",
		        data: [
		          [
		            "v16",
		            2.6
		          ],
		          [
		            "v15",
		            0.92
		          ],
		          [
		            "v14",
		            0.4
		          ],
		          [
		            "v13",
		            0.1
		          ]
		        ]
		      },
		      {
		        name: "Opera",
		        id: "Opera",
		        data: [
		          [
		            "v50.0",
		            0.96
		          ],
		          [
		            "v49.0",
		            0.82
		          ],
		          [
		            "v12.1",
		            0.14
		          ]
		        ]
		      }
		    ]
		  }
		});
	}
	
	// 모바일 어플 다은로드 통계 그래프
	function mobilePieHighcharts(){
		Highcharts.chart('mobilePie', {
		  chart: {
		    type: 'pie'
		  },
		  title: {
		    text: 'APP Download market store shares. 2022'
		  },
	
		  accessibility: {
		    announceNewData: {
		      enabled: true
		    },
		    point: {
		      valueSuffix: '%'
		    }
		  },
	
		  plotOptions: {
		    series: {
		      dataLabels: {
		        enabled: true,
		        format: '{point.name}: {point.y:.1f}%'
		      }
		    }
		  },
	
		  tooltip: {
		    headerFormat: '<span style="font-size:11px">{series.name}</span><br>',
		    pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'
		  },
	
		  series: [
		    {
		      name: "OS",
		      colorByPoint: true,
		      data: [
		        {
		          name: "Android",
		          y: 62.74,
		          drilldown: "Chrome"
		        },
		        {
		          name: "IOS",
		          y: 10.57,
		          drilldown: "Firefox"
		        },
		        {
		          name: "Other",
		          y: 7.62,
		          drilldown: null
		        }
		      ]
		    }
		  ],
		  drilldown: {
		    series: [
		      {
		        name: "Android",
		        id: "Android",
		        data: [
		          [
		            "v65.0",
		            0.1
		          ],
		          [
		            "v64.0",
		            1.3
		          ],
		          [
		            "v63.0",
		            53.02
		          ],
		          [
		            "v62.0",
		            1.4
		          ],
		          [
		            "v61.0",
		            0.88
		          ],
		          [
		            "v60.0",
		            0.56
		          ],
		          [
		            "v59.0",
		            0.45
		          ],
		          [
		            "v58.0",
		            0.49
		          ],
		          [
		            "v57.0",
		            0.32
		          ],
		          [
		            "v56.0",
		            0.29
		          ],
		          [
		            "v55.0",
		            0.79
		          ],
		          [
		            "v54.0",
		            0.18
		          ],
		          [
		            "v51.0",
		            0.13
		          ],
		          [
		            "v49.0",
		            2.16
		          ],
		          [
		            "v48.0",
		            0.13
		          ],
		          [
		            "v47.0",
		            0.11
		          ],
		          [
		            "v43.0",
		            0.17
		          ],
		          [
		            "v29.0",
		            0.26
		          ]
		        ]
		      },
		      {
		        name: "IOS",
		        id: "IOS",
		        data: [
		          [
		            "v58.0",
		            1.02
		          ],
		          [
		            "v57.0",
		            7.36
		          ],
		          [
		            "v56.0",
		            0.35
		          ],
		          [
		            "v55.0",
		            0.11
		          ],
		          [
		            "v54.0",
		            0.1
		          ],
		          [
		            "v52.0",
		            0.95
		          ],
		          [
		            "v51.0",
		            0.15
		          ],
		          [
		            "v50.0",
		            0.1
		          ],
		          [
		            "v48.0",
		            0.31
		          ],
		          [
		            "v47.0",
		            0.12
		          ]
		        ]
		      },
		      {
		        name: "Other",
		        id: "Other",
		        data: [
		          [
		            "v50.0",
		            0.96
		          ],
		          [
		            "v49.0",
		            0.82
		          ],
		          [
		            "v12.1",
		            0.14
		          ]
		        ]
		      }
		    ]
		  }
		});
	}
	function weekStatisticHighcharts(){	
		var title = {
	       text: '주간 로그인 통계 그래프'   
	    };
	    var xAxis = {
	       categories: ['6일전', '5일전', '4일전', '3일전', '2일전', '1일전','오늘']
	    };
	    var yAxis = {
	       title: {
	          text: 'total'
	       }, 
	       plotLines: [{
	          value: 0,
	          width: 1,
	          color: '#808080'
	       }]
	    };   

	    var legend = {
	       layout: 'vertical',
	       align: 'right',
	       verticalAlign: 'middle',
	       borderWidth: 0
	    };

	    var series =  [
	       {
	          name: '방문수',
	          data: [7.0, 6.9, 9.5, 14.5, 18.2, 21.5, 25.2]
	       }
	    ];

	    var json = {};

	    json.title = title;
	    json.xAxis = xAxis;
	    json.yAxis = yAxis;
	    json.legend = legend;
		json.series = series;

		$('#weekStatistic').highcharts(json);
	}
</script>



<!-- main-content opened -->
<div class="main-content horizontal-content">
	<!-- breadcrumbs -->
	<div class="breadcrumbs">
		<div class="bg-gray-100 bd-b">
			<div
				class="d-flex flex-row align-items-stretch ht-45 container admin-breadcrumbs"
			>
				<div class="pd-9 pd-l-0-f flex-grow-1">
					<a href="javascript:void(0);" class="tx-20">로그인 통계</a>
				</div>
				<div class="pd-10 bg-gray-200 d-none d-sm-block">
					<a href="javascript:void(0);"><i class="typcn typcn-home"></i></a>
				</div>
				<div class="pd-12 pd-r-0-f align-items-center d-none d-sm-flex">
					<a href="javascript:void(0);">관제</a> <i
						class="fe fe-chevron-right mx-2"
					></i> <a href="javascript:void(0);">로그인 통계</a>
				</div>
			</div>
		</div>
	</div>
	<!-- breadcrumbs closed -->

	<!-- container opened -->
	<div class="container">
		<div class="mg-t-35">

			<div class="d-flex justify-content-between align-items-end mg-b-10">
				<h4 class="mb-0 tx-bold tx-20">로그인 현황</h4>
				<label class="form-label-tx mr-2 d-none">시설</label>
				<div style="line-height: 1.2;" class="tx-primary">
					<select class="form-select" id="selectSite" name="selectSite" onChange="siteChange();">
						<option value="B:UCLIP:WEB">B2B WEB u-Clip(udid.hygera.kr)</option>
						<option value="B:X3:WEB">B2B WEB X-3(did.hygera.kr)</option>
						<option value="B::APP">B2B APP</option>
						<option value="C:UCLIP:WEB">B2C WEB(b2c.hygera.kr)</option>
						<option value="C:UCLIP:APP" selected>B2C APP</option>
						<option value="A::">MGR WEB(umgr.hygera.kr)</option>
					</select>
				</div>
			</div>
			<div class="border rounded">
				<div class="p-3">
					<div class="d-lg-flex align-items-start d-block">
						<h2 class="mb-0 tx-bold tx-20" id="countTitle"></h4>
						<h4 class="mb-0 tx-bold tx-20">오늘 방문수 </h4>
						<h4 class="mb-0 tx-bold tx-20">어제 방문수 </h4>
						<h4 class="mb-0 tx-bold tx-20">누적 방문수</h4>
					</div>
					<div class="d-lg-flex align-items-start d-block">
						<h4 class="mb-0 tx-bold tx-20">
							<span id="todayCnt">10 </span>
						</h4>
						<h4 class="mb-0 tx-bold tx-20">
							<span id="yesterdayCnt">10 </span>
						</h4>
						<h4 class="mb-0 tx-bold tx-20">
							<span id="accumulateCnt">100 </span>
						</h4>
					</div>
				</div>
			</div>
		</div>

		<div class="mg-t-35">
			<div class="d-flex justify-content-between align-items-end mg-b-10">
				<h4 class="mb-0 tx-bold tx-20">
					<span id="todayData"></span>
				</h4>
				<div style="line-height: 1.2;" class="tx-primary">
					<select class="form-select" id="selectLoginStatisticOption" name="selectLoginStatisticOption" onChange="containerHighcharts();">
						<option value="day">일간</option>
						<option value="month" selected>월간</option>
						<option value="year">년간</option>
					</select>
				</div>
			</div>
			<div class="border rounded">
				<div class="p-3">
					<figure class="highcharts-figure">
						<div id="container"></div>
					</figure>
				</div>
			</div>
			<div class="d-lg-flex align-items-start d-block">
				<figure class="highcharts-figure">
				  <div id="weekStatistic"></div>
				    <p class="highcharts-description" align="right" id="weekTodayDate">
					</p>
				</figure>
				<figure class="highcharts-figure">
				  <div id="webPie"></div>
				  <div id="mobilePie"></div>
				</figure>
			</div>
		</div>
	</div>
</div>
